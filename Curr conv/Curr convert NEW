import telebot
from CurrencyConverter import convert
from telebot import types
bot = telebot.TeleBot('6736242218:AAE6LL-DX4Am_Ezs3kU5aDstHJjOwyyTAmA')

amount = 0

@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id, '–ü—Ä–∏–≤–µ—Ç, –≤–≤–µ–¥–∏ —Å—É–º–º—É')
    bot.register_next_step_handler(message, summa)


def summa(message):
    global amount
    try:
        amount = int(message.text.strip())
    except ValueError:  #—Ñ–∏–∫—Å–∏—Ä—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –≤–≤–µ–ª–∏ –Ω–µ —á–∏—Å–ª–æ
        bot.send_message(message.chat.id, '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Çüò° –í–ø–∏—à–∏ —Å—É–º–º—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ')
        bot.register_next_step_handler(message, summa)
        return #–∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—É—Ç—å –∫ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º—É –∫–æ–¥—É –∏ –≥–æ–≤–æ—Ä–∏–º, —á—Ç–æ —Å–ª–µ–¥—É—é—â–µ–µ, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç —ç—Ç–æ —ç—Ç–∞ –∂–µ —Ñ—É–Ω–∫—Ü–∏—è
    
    if amount > 0:
        markup = types.InlineKeyboardMarkup(row_width=2) #—Å—Ä–∞–∑—É –¥–∞–µ–º –ø–æ–Ω—è—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç –º–∞–∫—Å–∏–º—É–º 2 –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥—É "row_width=2"
        btn1 = types.InlineKeyboardButton('RUB/KZT', callback_data='rub/kzt')
        btn2 = types.InlineKeyboardButton('KZT/RUB', callback_data='kzt/rub')
        btn3 = types.InlineKeyboardButton('KZT/USD', callback_data='kzt/usd')
        btn4 = types.InlineKeyboardButton('USD/KZT', callback_data='usd/kzt')        
        btn5 = types.InlineKeyboardButton('USD/EUR', callback_data='usd/eur')
        btn6 = types.InlineKeyboardButton('EUR/USD', callback_data='eur/usd')
        btn7 = types.InlineKeyboardButton('USD/GBP', callback_data='usd/gbp')
        btn8 = types.InlineKeyboardButton('–î—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ', callback_data='else')
        markup.add(btn1, btn2, btn3, btn4, btn5, btn6, btn7, btn8)
        bot.send_message(message.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—É –≤–∞–ª—é—Ç', reply_markup=markup)
    else:
        bot.send_message(message.chat.id, '–ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ —á–µ–º 0üò° –í–ø–∏—à–∏ —Å—É–º–º—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ')
        bot.register_next_step_handler(message, summa)


@bot.callback_query_handler(func=lambda call: True)
def callback(call):
    if call.data != 'else':
        values = call.data.upper().split('/') #upper –ø—Ä–∏–≤–æ–¥–∏–º –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É, split –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑–ª–µ–ª—è—Ç—å —Ç–µ–∫—Å—Ç –ø–æ –∑–Ω–∞–∫—É –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ —Å–ª–µ—à /
        res = convert(values[0], values[1], amount)
        bot.send_message(call.message.chat.id, f'–†–µ–∑—É–ª—å—Ç–∞—Ç: {res}. –ú–æ–∂–µ—à—å –ø–æ–≤—Ç–æ—Ä–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å—É–º–º—É –∏–ª–∏ –Ω–∞–∂–∞—Ç—å –µ—â–µ —Ä–∞–∑ –Ω–∞ –∫–Ω–æ–ø–∫—É') 
        #{round(res,2)} - –ø—Ä–æ–ø–∏—Å—ã–≤–∞—é, —á—Ç–æ–±—ã –≤ –æ—Ç–≤–µ—Ç–µ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π –±—ã–ª–æ –Ω–µ –±–æ–ª–µ 2 —Å–∏–º–≤–æ–ª–æ–≤
        bot.register_next_step_handler(call.message, summa)
    else:
        bot.send_message(call.message.chat.id, '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä—É –∑–Ω–∞—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ —Å–ª–µ—à "/"')
        bot.register_next_step_handler(call.message, my_currency)

def my_currency(message):
    try:
        values = message.text.upper().split('/')
        res = convert(values[0], values[1], amount)
        bot.send_message(message.chat.id, f'–†–µ–∑—É–ª—å—Ç–∞—Ç: {round(res, 2)}. –ú–æ–∂–µ—à—å –ø–æ–≤—Ç–æ—Ä–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å—É–º–º—É –∏–ª–∏ –Ω–∞–∂–∞—Ç—å –µ—â–µ —Ä–∞–∑ –Ω–∞ –∫–Ω–æ–ø–∫—É') 
        bot.register_next_step_handler(message, summa)
    except Exception:
        bot.send_message(message.chat.id, '–ß—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫üò° –í–ø–∏—à–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –µ—â–µ —Ä–∞–∑') 
        bot.register_next_step_handler(message, my_currency)

bot.infinity_polling()